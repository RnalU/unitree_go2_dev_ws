# TEB æ§åˆ¶å™¨é…ç½®æŒ‡å— - å››è¶³æœºå™¨ç‹—ä¸“ç”¨

## ğŸ• ä¸ºä»€ä¹ˆé€‰æ‹© TEB æ§åˆ¶å™¨ç”¨äºæœºå™¨ç‹—ï¼Ÿ

### TEB vs DWB å¯¹æ¯”

| ç‰¹æ€§ | DWB (åŠ¨æ€çª—å£æ³•) | TEB (æ—¶é—´å¼¹æ€§å¸¦) | æ¨è |
|------|-----------------|-----------------|------|
| **è½¨è¿¹å¹³æ»‘åº¦** | ä¸€èˆ¬ï¼ˆé‡‡æ ·ç¦»æ•£è½¨è¿¹ï¼‰ | ä¼˜ç§€ï¼ˆè¿ç»­ä¼˜åŒ–ï¼‰ | TEB âœ“ |
| **åŠ¨æ€é¿éšœ** | åŸºæœ¬æ”¯æŒ | ä¼˜ç§€ï¼ˆè€ƒè™‘æ—¶é—´ç»´åº¦ï¼‰ | TEB âœ“ |
| **é€Ÿåº¦å˜åŒ–** | å¯èƒ½çªå˜ | å¹³æ»‘è¿‡æ¸¡ | TEB âœ“ |
| **å¤æ‚ç¯å¢ƒ** | ä¸€èˆ¬ | ä¼˜ç§€ï¼ˆå¤šè·¯å¾„è§„åˆ’ï¼‰ | TEB âœ“ |
| **å››è¶³æ­¥æ€** | éœ€è¦é¢å¤–å¹³æ»‘ | å¤©ç„¶é€‚é… | TEB âœ“ |
| **è®¡ç®—èµ„æº** | ä½ | ä¸­ç­‰ | DWB âœ“ |
| **é…ç½®å¤æ‚åº¦** | ç®€å• | ä¸­ç­‰ | DWB âœ“ |

**ç»“è®ºï¼š** TEB æ›´é€‚åˆå››è¶³æœºå™¨ç‹—ï¼Œå› ä¸ºï¼š
1. âœ… æ›´å¹³æ»‘çš„è½¨è¿¹å¯¹å››è¶³æ­¥æ€æ›´å‹å¥½
2. âœ… é€Ÿåº¦å˜åŒ–æ›´è‡ªç„¶ï¼Œå‡å°‘æœºå™¨ç‹—çš„æŠ–åŠ¨
3. âœ… æ›´å¥½çš„åŠ¨æ€é¿éšœèƒ½åŠ›
4. âœ… æ”¯æŒå¤šå€™é€‰è·¯å¾„ï¼ˆåŒä¼¦ç±»è§„åˆ’ï¼‰

---

## ğŸ“ å…³é”®å‚æ•°è¯´æ˜

### 1. æœºå™¨äººé…ç½®

```yaml
max_vel_x: 0.5              # æœ€å¤§å‰è¿›é€Ÿåº¦
max_vel_x_backwards: 0.3    # æœ€å¤§åé€€é€Ÿåº¦
max_vel_theta: 1.0          # æœ€å¤§æ—‹è½¬é€Ÿåº¦
acc_lim_x: 1.5              # çº¿åŠ é€Ÿåº¦
acc_lim_theta: 2.0          # è§’åŠ é€Ÿåº¦
```

**ğŸ”§ è°ƒæ•´å»ºè®®ï¼š**
- Unitree A1: `max_vel_x: 1.0`, `max_vel_theta: 1.5`
- Unitree Go1: `max_vel_x: 0.8`, `max_vel_theta: 1.2`
- Unitree Go2: `max_vel_x: 1.5`, `max_vel_theta: 2.0`

### 2. æœºå™¨äººè¶³è¿¹ï¼ˆFootprintï¼‰

```yaml
footprint_model:
  type: "polygon"
  vertices: [[0.3, 0.2], [0.3, -0.2], [-0.3, -0.2], [-0.3, 0.2]]
```

**ğŸ“ å¦‚ä½•æµ‹é‡ï¼š**
```
     å‰
    â”Œâ”€â”€â”€â”€â”€â”
    â”‚  o  â”‚  o = æœºå™¨äººä¸­å¿ƒ
    â””â”€â”€â”€â”€â”€â”˜
     å

é•¿åº¦ = é¼»å­åˆ°å°¾å·´çš„è·ç¦»
å®½åº¦ = ä¸¤ä¾§æœ€å®½å¤„çš„è·ç¦»
```

**ä¸åŒå‹å·å‚è€ƒï¼š**
```yaml
# Unitree A1 (çº¦ 0.6m x 0.3m)
vertices: [[0.35, 0.18], [0.35, -0.18], [-0.25, -0.18], [-0.25, 0.18]]

# Unitree Go1 (çº¦ 0.65m x 0.28m)
vertices: [[0.38, 0.16], [0.38, -0.16], [-0.27, -0.16], [-0.27, 0.16]]

# Unitree B1 (çº¦ 1.0m x 0.4m)
vertices: [[0.55, 0.22], [0.55, -0.22], [-0.45, -0.22], [-0.45, 0.22]]
```

### 3. éšœç¢ç‰©é…ç½®

```yaml
min_obstacle_dist: 0.3      # æœ€å°éšœç¢ç‰©è·ç¦»
inflation_dist: 0.4         # éšœç¢ç‰©è†¨èƒ€è·ç¦»
weight_obstacle: 50.0       # éšœç¢ç‰©é¿è®©æƒé‡
```

**å®‰å…¨è·ç¦»å»ºè®®ï¼š**
- å®¤å†…ç¯å¢ƒï¼š`min_obstacle_dist: 0.2`
- å®¤å¤–ç¯å¢ƒï¼š`min_obstacle_dist: 0.3`
- æ‹¥æŒ¤ç¯å¢ƒï¼š`min_obstacle_dist: 0.4`

### 4. è½¨è¿¹ä¼˜åŒ–æƒé‡

```yaml
weight_kinematics_nh: 1000.0           # éå®Œæ•´çº¦æŸï¼ˆé‡è¦ï¼ï¼‰
weight_kinematics_forward_drive: 10.0  # é¼“åŠ±å‰è¿›
weight_optimaltime: 1.0                # æ—¶é—´æœ€ä¼˜
weight_obstacle: 50.0                  # éšœç¢ç‰©é¿è®©
weight_dynamic_obstacle: 50.0          # åŠ¨æ€éšœç¢ç‰©
```

**æƒé‡è°ƒä¼˜æŠ€å·§ï¼š**
- **æœºå™¨ç‹—å€¾å‘åé€€ï¼Ÿ** â†’ å¢åŠ  `weight_kinematics_forward_drive: 20.0`
- **è¿‡äºä¿å®ˆï¼Œä¸æ•¢æ¥è¿‘éšœç¢ç‰©ï¼Ÿ** â†’ å‡å° `weight_obstacle: 30.0`
- **å¤ªæ¿€è¿›ï¼Œå®¹æ˜“ç¢°æ’ï¼Ÿ** â†’ å¢åŠ  `weight_obstacle: 80.0`
- **é€Ÿåº¦å¤ªæ…¢ï¼Ÿ** â†’ å¢åŠ  `weight_optimaltime: 2.0`
- **è¿åŠ¨ä¸æµç•…ï¼Ÿ** â†’ å¢åŠ  `weight_kinematics_nh: 2000.0`

### 5. åŒä¼¦ç±»è§„åˆ’ï¼ˆå¤šè·¯å¾„å€™é€‰ï¼‰

```yaml
enable_homotopy_class_planning: True   # å¯ç”¨å¤šè·¯å¾„è§„åˆ’
max_number_classes: 4                  # æœ€å¤š4æ¡å€™é€‰è·¯å¾„
```

**ä»€ä¹ˆæ˜¯åŒä¼¦ç±»è§„åˆ’ï¼Ÿ**
```
èµ·ç‚¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> ç»ˆç‚¹
        â•±éšœç¢ç‰©â•²
       
è·¯å¾„1: ä»å·¦è¾¹ç»•è¿‡  â†â”
è·¯å¾„2: ä»å³è¾¹ç»•è¿‡  â†â”¼â”€ åŒæ—¶è®¡ç®—å¤šæ¡è·¯å¾„
è·¯å¾„3: ä»å‰é¢ç©¿è¿‡  â†â”˜    é€‰æ‹©æœ€ä¼˜çš„ä¸€æ¡
```

**ä¼˜åŠ¿ï¼š**
- è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜è·¯å¾„
- è¢«ä¸€æ¡è·¯å¾„é˜»å¡æ—¶å¯å¿«é€Ÿåˆ‡æ¢
- é€‚åº”åŠ¨æ€ç¯å¢ƒ

**æ€§èƒ½å½±å“ï¼š**
- `max_number_classes: 2` - ä½è®¡ç®—é‡
- `max_number_classes: 4` - ä¸­ç­‰ï¼ˆæ¨èï¼‰
- `max_number_classes: 8` - é«˜è®¡ç®—é‡

---

## ğŸ¯ é’ˆå¯¹ä¸åŒåœºæ™¯çš„è°ƒä¼˜

### åœºæ™¯ 1: å®¤å†…åŠå…¬ç¯å¢ƒ

```yaml
max_vel_x: 0.4              # é™ä½é€Ÿåº¦
min_obstacle_dist: 0.25     # è¾ƒå°å®‰å…¨è·ç¦»
weight_optimaltime: 0.5     # ä¸è¿½æ±‚å¿«é€Ÿ
weight_obstacle: 60.0       # ä¿å®ˆé¿éšœ
```

### åœºæ™¯ 2: å®¤å¤–å¼€é˜”åœºåœ°

```yaml
max_vel_x: 1.0              # æé«˜é€Ÿåº¦
min_obstacle_dist: 0.3      # æ ‡å‡†å®‰å…¨è·ç¦»
weight_optimaltime: 2.0     # è¿½æ±‚å¿«é€Ÿ
weight_obstacle: 40.0       # å…è®¸æ›´æ¥è¿‘éšœç¢ç‰©
```

### åœºæ™¯ 3: ç‹­çª„èµ°å»Š

```yaml
max_vel_x: 0.3              # é™ä½é€Ÿåº¦
min_obstacle_dist: 0.2      # æ›´å°å®‰å…¨è·ç¦»
weight_kinematics_forward_drive: 20.0  # å¼ºçƒˆé¼“åŠ±å‰è¿›
max_global_plan_lookahead_dist: 1.5    # å‡å°å‰ç»è·ç¦»
```

### åœºæ™¯ 4: åŠ¨æ€äººç¾¤ç¯å¢ƒ

```yaml
include_dynamic_obstacles: True
dynamic_obstacle_inflation_dist: 0.6    # å¢å¤§åŠ¨æ€éšœç¢ç‰©è·ç¦»
weight_dynamic_obstacle: 80.0           # é«˜ä¼˜å…ˆçº§é¿è®©
enable_homotopy_class_planning: True    # å¯ç”¨å¤šè·¯å¾„
max_number_classes: 4                   # æ›´å¤šå€™é€‰è·¯å¾„
```

---

## ğŸ”§ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1: æœºå™¨ç‹—èµ°èµ°åœåœï¼Œä¸æµç•…

**åŸå› ï¼š** è½¨è¿¹ä¼˜åŒ–ä¸å¤Ÿå¹³æ»‘

**è§£å†³ï¼š**
```yaml
dt_ref: 0.4                 # å¢åŠ æ—¶é—´åˆ†è¾¨ç‡ï¼ˆ0.3 â†’ 0.4ï¼‰
weight_max_vel_x: 1.0       # å‡å°é€Ÿåº¦æƒé‡ï¼ˆ2.0 â†’ 1.0ï¼‰
weight_acc_lim_x: 2.0       # å¢åŠ åŠ é€Ÿåº¦é™åˆ¶æƒé‡
no_inner_iterations: 8      # å¢åŠ ä¼˜åŒ–è¿­ä»£æ¬¡æ•°
```

### é—®é¢˜ 2: æœºå™¨ç‹—å€¾å‘äºåé€€

**åŸå› ï¼š** å‰è¿›é©±åŠ¨æƒé‡ä¸è¶³

**è§£å†³ï¼š**
```yaml
weight_kinematics_forward_drive: 50.0   # å¤§å¹…å¢åŠ ï¼ˆ10.0 â†’ 50.0ï¼‰
allow_init_with_backwards_motion: False # ç¦æ­¢åˆå§‹åé€€
max_vel_x_backwards: 0.1                # é™åˆ¶åé€€é€Ÿåº¦
```

### é—®é¢˜ 3: æœºå™¨ç‹—ç»•è¿œè·¯

**åŸå› ï¼š** éšœç¢ç‰©é¿è®©è¿‡äºä¿å®ˆ

**è§£å†³ï¼š**
```yaml
min_obstacle_dist: 0.2      # å‡å°å®‰å…¨è·ç¦»ï¼ˆ0.3 â†’ 0.2ï¼‰
weight_obstacle: 30.0       # å‡å°é¿éšœæƒé‡ï¼ˆ50.0 â†’ 30.0ï¼‰
weight_shortest_path: 1.0   # å¯ç”¨æœ€çŸ­è·¯å¾„æƒé‡
```

### é—®é¢˜ 4: è®¡ç®—å¤ªæ…¢ï¼Œæ§åˆ¶å™¨é¢‘ç‡ä½

**åŸå› ï¼š** ä¼˜åŒ–å‚æ•°è¿‡äºå¤æ‚

**è§£å†³ï¼š**
```yaml
no_inner_iterations: 3      # å‡å°‘è¿­ä»£ï¼ˆ5 â†’ 3ï¼‰
no_outer_iterations: 3      # å‡å°‘è¿­ä»£ï¼ˆ4 â†’ 3ï¼‰
max_number_classes: 2       # å‡å°‘å€™é€‰è·¯å¾„ï¼ˆ4 â†’ 2ï¼‰
enable_multithreading: True # ç¡®ä¿å¯ç”¨å¤šçº¿ç¨‹
```

### é—®é¢˜ 5: æœºå™¨ç‹—åŸåœ°æ‰“è½¬

**åŸå› ï¼š** å±€éƒ¨æœ€ä¼˜è§£ï¼Œè¢«å›°ä½äº†

**è§£å†³ï¼š**
```yaml
oscillation_recovery: True              # å¯ç”¨æŒ¯è¡æ¢å¤
oscillation_recovery_min_duration: 5.0  # å‡å°‘æ¢å¤æ—¶é—´
shrink_horizon_backup: True             # å¯ç”¨è§†é‡æ”¶ç¼©
force_reinit_new_goal_dist: 0.5         # å‡å°é‡æ–°åˆå§‹åŒ–è·ç¦»
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### æŸ¥çœ‹ TEB æ€§èƒ½

```bash
# æŸ¥çœ‹æ§åˆ¶å™¨é¢‘ç‡
ros2 topic hz /cmd_vel

# æŸ¥çœ‹è½¨è¿¹å¯è§†åŒ–
# åœ¨ RVIZ ä¸­æ·»åŠ ï¼š
#   - MarkerArray: /teb_markers
#   - Path: /local_plan

# æŸ¥çœ‹è®¡ç®—æ—¶é—´
ros2 topic echo /diagnostics --field values
```

### æœŸæœ›çš„æ€§èƒ½æŒ‡æ ‡

- **æ§åˆ¶å™¨é¢‘ç‡**: 15-20 Hzï¼ˆæœ€ä½ 10 Hzï¼‰
- **è®¡ç®—å»¶è¿Ÿ**: < 50 ms
- **è½¨è¿¹ç‚¹æ•°**: 10-20 ä¸ª
- **å€™é€‰è·¯å¾„æ•°**: 2-4 æ¡

---

## ğŸ“ ä¸å…¶ä»–æ§åˆ¶å™¨çš„åˆ‡æ¢

### å¦‚ä½•åˆ‡æ¢å› DWBï¼Ÿ

åªéœ€ä¿®æ”¹ä¸€è¡Œï¼š
```yaml
FollowPath:
  plugin: "dwb_core::DWBLocalPlanner"
  # ... DWB å‚æ•° ...
```

### å¦‚ä½•å°è¯•å…¶ä»–æ§åˆ¶å™¨ï¼Ÿ

**MPPI (Model Predictive Path Integral)**
```yaml
plugin: "nav2_mppi_controller::MPPIController"
# é€‚åˆï¼šé«˜çº§åº”ç”¨ï¼Œéœ€è¦åŠ¨æ€æ¨¡å‹
```

**RPP (Regulated Pure Pursuit)**
```yaml
plugin: "nav2_regulated_pure_pursuit_controller::RegulatedPurePursuitController"
# é€‚åˆï¼šç®€å•å¿«é€Ÿï¼Œç±»è½¦æœºå™¨äºº
```

**Graceful Controller**
```yaml
plugin: "nav2_graceful_controller::GracefulController"
# é€‚åˆï¼šä¼˜é›…çš„å¼§çº¿è¿åŠ¨
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [TEB å®˜æ–¹æ–‡æ¡£](http://wiki.ros.org/teb_local_planner)
- [TEB è®ºæ–‡](http://www.rst.e-technik.tu-dortmund.de/~chl/publications/Roesmann2013.pdf)
- [Nav2 TEB é…ç½®](https://docs.nav2.org/configuration/packages/configuring-teb-controller.html)
- [TEB è°ƒä¼˜æŒ‡å—](https://docs.nav2.org/tuning/index.html)

---

## ğŸ’¡ ä¸“ä¸šå»ºè®®

1. **ä»ä¿å®ˆå‚æ•°å¼€å§‹**
   - å…ˆä½¿ç”¨é»˜è®¤é…ç½®
   - é€æ­¥å¢åŠ é€Ÿåº¦å’Œé™ä½å®‰å…¨è·ç¦»

2. **åœ¨ä»¿çœŸä¸­æµ‹è¯•**
   - å…ˆåœ¨ Gazebo ä¸­éªŒè¯
   - å†éƒ¨ç½²åˆ°çœŸå®æœºå™¨ç‹—

3. **è®°å½•è°ƒä¼˜è¿‡ç¨‹**
   - è®°å½•æ¯æ¬¡å‚æ•°ä¿®æ”¹
   - å¯¹æ¯”ä¸åŒé…ç½®çš„æ•ˆæœ

4. **ä½¿ç”¨å¯è§†åŒ–å·¥å…·**
   - RVIZ æŸ¥çœ‹è½¨è¿¹
   - Plotjuggler åˆ†æé€Ÿåº¦æ›²çº¿

5. **åˆ†åœºæ™¯ä¼˜åŒ–**
   - ä¸ºä¸åŒç¯å¢ƒå‡†å¤‡å¤šå¥—å‚æ•°
   - é€šè¿‡å¯åŠ¨å‚æ•°åˆ‡æ¢

---

**ç¥ä½ çš„æœºå™¨ç‹—å¯¼èˆªé¡ºåˆ©ï¼** ğŸ•ğŸš€

å¦‚æœ‰é—®é¢˜ï¼Œè®°å¾—æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
ros2 launch nav_launcher unitree_navigation.launch.py --log-level debug
```
