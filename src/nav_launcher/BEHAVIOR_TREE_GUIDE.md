# ğŸŒ³ Nav2 è¡Œä¸ºæ ‘ï¼ˆBehavior Treeï¼‰è¯¦è§£

## ä»€ä¹ˆæ˜¯è¡Œä¸ºæ ‘ï¼Ÿ

è¡Œä¸ºæ ‘ï¼ˆBehavior Tree, BTï¼‰æ˜¯ Nav2 çš„**æ ¸å¿ƒå†³ç­–ç³»ç»Ÿ**ï¼Œå®ƒæ§åˆ¶æœºå™¨äººåœ¨å¯¼èˆªè¿‡ç¨‹ä¸­çš„æ‰€æœ‰è¡Œä¸ºå’Œå†³ç­–ã€‚

### ç®€å•ç±»æ¯”

æƒ³è±¡ä½ åœ¨å¼€è½¦å¯¼èˆªï¼š
```
å¼€å§‹å¯¼èˆª
â”œâ”€ æ˜¯å¦çŸ¥é“ç›®çš„åœ°ï¼Ÿ
â”‚  â”œâ”€ æ˜¯ â†’ è§„åˆ’è·¯çº¿
â”‚  â””â”€ å¦ â†’ è¿”å›é”™è¯¯
â”œâ”€ å‰æ–¹æœ‰éšœç¢ç‰©ï¼Ÿ
â”‚  â”œâ”€ æ˜¯ â†’ ç»•è¡Œ
â”‚  â””â”€ å¦ â†’ ç»§ç»­å‰è¿›
â”œâ”€ é‡åˆ°äº¤é€šå µå¡ï¼Ÿ
â”‚  â”œâ”€ æ˜¯ â†’ é‡æ–°è§„åˆ’è·¯çº¿
â”‚  â””â”€ å¦ â†’ ç»§ç»­å‰è¿›
â””â”€ åˆ°è¾¾ç›®çš„åœ°ï¼Ÿ
   â””â”€ æ˜¯ â†’ å®Œæˆå¯¼èˆª
```

è¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„è¡Œä¸ºæ ‘ï¼Nav2 ç”¨å®ƒæ¥ç®¡ç†æœºå™¨äººçš„å¯¼èˆªå†³ç­–ã€‚

---

## ğŸ†š ROS1 vs ROS2 å¯¹æ¯”

### ROS1 (move_base) - ç®€å•çŠ¶æ€æœº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç­‰å¾…ç›®æ ‡         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ æ¥æ”¶ç›®æ ‡
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è§„åˆ’è·¯å¾„         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ æˆåŠŸ
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ‰§è¡Œè·¯å¾„         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ æˆåŠŸ/å¤±è´¥
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¢å¤è¡Œä¸º         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å±€é™æ€§ï¼š**
- âŒ å†³ç­–é€»è¾‘å›ºå®šï¼Œéš¾ä»¥ä¿®æ”¹
- âŒ ä¸èƒ½å¤„ç†å¤æ‚åœºæ™¯
- âŒ æ²¡æœ‰å¯è§†åŒ–å·¥å…·
- âŒ æ¢å¤ç­–ç•¥ç®€å•

### ROS2 (Nav2) - è¡Œä¸ºæ ‘

```
                 å¼€å§‹å¯¼èˆª
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
   æ£€æŸ¥ç›®æ ‡æœ‰æ•ˆï¼Ÿ           è§„åˆ’å…¨å±€è·¯å¾„
        â”‚                       â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
   æˆåŠŸ    å¤±è´¥        æˆåŠŸ             å¤±è´¥
    â”‚       â”‚           â”‚                 â”‚
  ç»§ç»­   æŠ¥é”™      è·Ÿéšè·¯å¾„          é‡æ–°è§„åˆ’
                        â”‚                 â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
                â”‚                â”‚       â”‚
          é‡åˆ°éšœç¢ï¼Ÿ         åˆ°è¾¾ç›®æ ‡ï¼Ÿ   â”‚
                â”‚                â”‚       â”‚
            â”Œâ”€â”€â”€â”´â”€â”€â”€â”        â”Œâ”€â”€â”€â”´â”€â”€â”€â”  â”‚
           æ˜¯      å¦        æ˜¯      å¦  â”‚
            â”‚       â”‚         â”‚       â”‚  â”‚
        å±€éƒ¨é‡è§„åˆ’  ç»§ç»­   å®Œæˆå¯¼èˆª  ç»§ç»­ â”‚
            â”‚       â”‚         â”‚       â”‚  â”‚
            â””â”€â”€â”€â”¬â”€â”€â”€â”˜         â”‚       â”‚  â”‚
                â”‚             â”‚       â”‚  â”‚
            è¢«å›°äº†å—ï¼Ÿ         â”‚       â”‚  â”‚
                â”‚             â”‚       â”‚  â”‚
            â”Œâ”€â”€â”€â”´â”€â”€â”€â”         â”‚       â”‚  â”‚
           æ˜¯      å¦         â”‚       â”‚  â”‚
            â”‚       â”‚         â”‚       â”‚  â”‚
       æ‰§è¡Œæ¢å¤è¡Œä¸º  ç»§ç»­      â”‚       â”‚  â”‚
            â”‚       â”‚         â”‚       â”‚  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”˜
```

**ä¼˜åŠ¿ï¼š**
- âœ… çµæ´»å¯é…ç½®
- âœ… æ”¯æŒå¤æ‚å†³ç­–é€»è¾‘
- âœ… å¯è§†åŒ–ç¼–è¾‘ï¼ˆGrootï¼‰
- âœ… æ¨¡å—åŒ–ã€æ˜“æ‰©å±•
- âœ… æ™ºèƒ½æ¢å¤ç­–ç•¥

---

## ğŸ¯ è¡Œä¸ºæ ‘çš„ä½œç”¨

### 1. æ™ºèƒ½å†³ç­–

**åœºæ™¯ï¼šæœºå™¨ç‹—é‡åˆ°éšœç¢ç‰©**

```
æ£€æµ‹åˆ°éšœç¢ç‰©
    â”‚
    â”œâ”€ éšœç¢ç‰©æ˜¯å¦ç§»åŠ¨ï¼Ÿ
    â”‚   â”œâ”€ æ˜¯ï¼ˆäºº/å…¶ä»–æœºå™¨äººï¼‰
    â”‚   â”‚   â””â”€> ç­‰å¾…ä¸€æ®µæ—¶é—´
    â”‚   â”‚        â”‚
    â”‚   â”‚        â””â”€> éšœç¢ç‰©ç§»å¼€ï¼Ÿ
    â”‚   â”‚             â”œâ”€ æ˜¯ â†’ ç»§ç»­å‰è¿›
    â”‚   â”‚             â””â”€ å¦ â†’ é‡æ–°è§„åˆ’ç»•è¡Œ
    â”‚   â”‚
    â”‚   â””â”€ å¦ï¼ˆé™æ€éšœç¢ï¼‰
    â”‚       â””â”€> ç›´æ¥é‡æ–°è§„åˆ’ç»•è¡Œ
    â”‚
    â””â”€ ç»•è¡Œå¤±è´¥ï¼Ÿ
        â””â”€> å°è¯•åé€€ â†’ é‡æ–°å°è¯•
```

### 2. è‡ªåŠ¨æ¢å¤

**åœºæ™¯ï¼šæœºå™¨ç‹—è¢«å›°ä½**

```
æ£€æµ‹åˆ°è¢«å›°
    â”‚
    â”œâ”€> æ¸…ç©ºå±€éƒ¨ä»£ä»·åœ°å›¾
    â”‚    â””â”€> é‡æ–°è§„åˆ’
    â”‚         â”œâ”€ æˆåŠŸ â†’ ç»§ç»­å¯¼èˆª
    â”‚         â””â”€ å¤±è´¥ â†“
    â”‚
    â”œâ”€> åŸåœ°æ—‹è½¬ 360Â°
    â”‚    â””â”€> é‡æ–°æ„ŸçŸ¥ç¯å¢ƒ
    â”‚         â””â”€> é‡æ–°è§„åˆ’
    â”‚              â”œâ”€ æˆåŠŸ â†’ ç»§ç»­å¯¼èˆª
    â”‚              â””â”€ å¤±è´¥ â†“
    â”‚
    â”œâ”€> åé€€ 0.5 ç±³
    â”‚    â””â”€> å°è¯•æ–°è·¯å¾„
    â”‚         â”œâ”€ æˆåŠŸ â†’ ç»§ç»­å¯¼èˆª
    â”‚         â””â”€ å¤±è´¥ â†“
    â”‚
    â””â”€> å…¨å±€é‡æ–°è§„åˆ’
         â””â”€> å°è¯•å®Œå…¨ä¸åŒçš„è·¯å¾„
              â”œâ”€ æˆåŠŸ â†’ ç»§ç»­å¯¼èˆª
              â””â”€ å¤±è´¥ â†’ æŠ¥å‘Šæ— æ³•åˆ°è¾¾
```

### 3. å¤šç›®æ ‡å¯¼èˆª

**åœºæ™¯ï¼šå·¡é€»å¤šä¸ªè·¯ç‚¹**

```
å¼€å§‹å¤šç‚¹å·¡é€»
    â”‚
    â”œâ”€> è·å–è·¯ç‚¹åˆ—è¡¨ [A, B, C, D]
    â”‚
    â”œâ”€> å¯¼èˆªåˆ° A
    â”‚    â”œâ”€ æˆåŠŸ â†’ åœ¨ A ç‚¹æ‰§è¡Œä»»åŠ¡ï¼ˆç­‰å¾…/æ‹ç…§ç­‰ï¼‰
    â”‚    â””â”€ å¤±è´¥ â†’ è®°å½•å¤±è´¥ï¼Œç»§ç»­ä¸‹ä¸€ä¸ª
    â”‚
    â”œâ”€> å¯¼èˆªåˆ° B
    â”‚    â”œâ”€ æˆåŠŸ â†’ æ‰§è¡Œä»»åŠ¡
    â”‚    â””â”€ å¤±è´¥ â†’ è®°å½•å¤±è´¥ï¼Œç»§ç»­ä¸‹ä¸€ä¸ª
    â”‚
    â”œâ”€> å¯¼èˆªåˆ° C
    â”‚    â””â”€> ...
    â”‚
    â””â”€> æ‰€æœ‰ç‚¹å·¡é€»å®Œæˆ
         â””â”€> è¿”å›èµ·ç‚¹ æˆ– æŠ¥å‘Šå®Œæˆ
```

### 4. å¤æ‚è¡Œä¸ºç¼–æ’

**åœºæ™¯ï¼šæœºå™¨ç‹—å……ç”µä»»åŠ¡**

```
ç”µé‡æ£€æŸ¥
    â”‚
    â”œâ”€ ç”µé‡ < 20%ï¼Ÿ
    â”‚   â”œâ”€ æ˜¯
    â”‚   â”‚   â””â”€> ä¿å­˜å½“å‰ä»»åŠ¡
    â”‚   â”‚        â”‚
    â”‚   â”‚        â””â”€> å¯¼èˆªåˆ°å……ç”µæ¡©
    â”‚   â”‚             â”‚
    â”‚   â”‚             â”œâ”€ åˆ°è¾¾å……ç”µæ¡©
    â”‚   â”‚             â”‚   â””â”€> å¯¹å‡†å……ç”µæ¥å£
    â”‚   â”‚             â”‚        â”‚
    â”‚   â”‚             â”‚        â””â”€> å¼€å§‹å……ç”µ
    â”‚   â”‚             â”‚             â”‚
    â”‚   â”‚             â”‚             â””â”€> ç”µé‡ > 80%ï¼Ÿ
    â”‚   â”‚             â”‚                  â”œâ”€ æ˜¯ â†’ æ¢å¤ä¹‹å‰ä»»åŠ¡
    â”‚   â”‚             â”‚                  â””â”€ å¦ â†’ ç»§ç»­å……ç”µ
    â”‚   â”‚             â”‚
    â”‚   â”‚             â””â”€ æ‰¾ä¸åˆ°å……ç”µæ¡©
    â”‚   â”‚                 â””â”€> åŸåœ°å¾…æœºï¼Œå‘é€è­¦æŠ¥
    â”‚   â”‚
    â”‚   â””â”€ å¦ â†’ ç»§ç»­å½“å‰ä»»åŠ¡
    â”‚
    â””â”€> æ­£å¸¸å·¥ä½œ
```

---

## ğŸ“¦ Nav2 è¡Œä¸ºæ ‘èŠ‚ç‚¹ç±»å‹

### 1. æ§åˆ¶èŠ‚ç‚¹ï¼ˆControl Nodesï¼‰

**Sequenceï¼ˆåºåˆ—ï¼‰**
```
æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸€ä¸ªå¤±è´¥åˆ™å…¨éƒ¨å¤±è´¥
ä¾‹ï¼šè§„åˆ’è·¯å¾„ â†’ æ£€æŸ¥è·¯å¾„ â†’ æ‰§è¡Œè·¯å¾„
```

**Fallbackï¼ˆå›é€€ï¼‰**
```
å°è¯•å¤šä¸ªé€‰é¡¹ï¼Œç›´åˆ°ä¸€ä¸ªæˆåŠŸ
ä¾‹ï¼šè·¯å¾„A â†’ å¤±è´¥ â†’ è·¯å¾„B â†’ æˆåŠŸ
```

**Parallelï¼ˆå¹¶è¡Œï¼‰**
```
åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡
ä¾‹ï¼šå¯¼èˆª + é¿éšœ + ç›‘æ§ç”µé‡
```

### 2. è¡Œä¸ºèŠ‚ç‚¹ï¼ˆAction Nodesï¼‰

Nav2 æä¾›çš„è¡Œä¸ºèŠ‚ç‚¹ï¼š

| èŠ‚ç‚¹åç§° | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|---------|------|---------|
| `ComputePathToPose` | è®¡ç®—åˆ°ç›®æ ‡çš„è·¯å¾„ | å…¨å±€è·¯å¾„è§„åˆ’ |
| `FollowPath` | è·Ÿéšè·¯å¾„ | å±€éƒ¨è·¯å¾„è·Ÿè¸ª |
| `ClearCostmapExceptRegion` | æ¸…ç©ºä»£ä»·åœ°å›¾ | æ¢å¤è¡Œä¸º |
| `Spin` | åŸåœ°æ—‹è½¬ | è¢«å›°æ¢å¤ |
| `BackUp` | åé€€ | è¢«å›°æ¢å¤ |
| `Wait` | ç­‰å¾… | ç­‰å¾…éšœç¢ç‰©ç§»å¼€ |
| `DriveOnHeading` | æœæŒ‡å®šæ–¹å‘è¡Œé©¶ | ç®€å•è¿åŠ¨ |

### 3. æ¡ä»¶èŠ‚ç‚¹ï¼ˆCondition Nodesï¼‰

| èŠ‚ç‚¹åç§° | æ£€æŸ¥å†…å®¹ |
|---------|---------|
| `GoalReached` | æ˜¯å¦åˆ°è¾¾ç›®æ ‡ |
| `IsBatteryLow` | ç”µé‡æ˜¯å¦è¿‡ä½ |
| `IsStuck` | æ˜¯å¦è¢«å›° |
| `DistanceTraveled` | å·²è¡Œé©¶è·ç¦» |
| `TimeExpired` | æ˜¯å¦è¶…æ—¶ |

---

## ğŸ”§ è‡ªå®šä¹‰è¡Œä¸ºæ ‘

### é»˜è®¤å¯¼èˆªè¡Œä¸ºæ ‘

Nav2 æä¾›çš„é»˜è®¤è¡Œä¸ºæ ‘ä½äºï¼š
```
/opt/ros/humble/share/nav2_bt_navigator/behavior_trees/
â”œâ”€â”€ navigate_to_pose_w_replanning_and_recovery.xml
â”œâ”€â”€ navigate_through_poses_w_replanning_and_recovery.xml
â””â”€â”€ ...
```

### å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰è¡Œä¸ºæ ‘ï¼Ÿ

#### æ­¥éª¤ 1: åˆ›å»ºè‡ªå®šä¹‰è¡Œä¸ºæ ‘æ–‡ä»¶

```bash
mkdir -p /home/ymc/ros2_nav_unitree_ws/src/nav_launcher/behavior_trees
```

åˆ›å»ºæ–‡ä»¶ `custom_navigation.xml`ï¼š

```xml
<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <RecoveryNode number_of_retries="6" name="NavigateRecovery">
      
      <!-- ä¸»å¯¼èˆªé€»è¾‘ -->
      <PipelineSequence name="NavigateWithReplanning">
        <!-- è®¡ç®—è·¯å¾„ -->
        <RateController hz="1.0">
          <RecoveryNode number_of_retries="1" name="ComputePathToPose">
            <ComputePathToPose goal="{goal}" path="{path}" planner_id="GridBased"/>
            <ClearEntireCostmap name="ClearGlobalCostmap-Context" service_name="global_costmap/clear_entirely_global_costmap"/>
          </RecoveryNode>
        </RateController>

        <!-- è·Ÿéšè·¯å¾„ -->
        <RecoveryNode number_of_retries="1" name="FollowPath">
          <FollowPath path="{path}" controller_id="FollowPath"/>
          <ClearEntireCostmap name="ClearLocalCostmap-Context" service_name="local_costmap/clear_entirely_local_costmap"/>
        </RecoveryNode>
      </PipelineSequence>

      <!-- æ¢å¤è¡Œä¸º -->
      <ReactiveFallback name="RecoveryFallback">
        <GoalUpdated/>
        <SequenceStar name="RecoveryActions">
          <!-- æ¸…ç©ºä»£ä»·åœ°å›¾ -->
          <ClearEntireCostmap name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_entirely_local_costmap"/>
          <ClearEntireCostmap name="ClearGlobalCostmap-Subtree" service_name="global_costmap/clear_entirely_global_costmap"/>
          
          <!-- æ—‹è½¬ -->
          <Spin spin_dist="1.57"/>
          
          <!-- åé€€ -->
          <Wait wait_duration="5"/>
          <BackUp backup_dist="0.30" backup_speed="0.05"/>
        </SequenceStar>
      </ReactiveFallback>
      
    </RecoveryNode>
  </BehaviorTree>
</root>
```

#### æ­¥éª¤ 2: åœ¨å‚æ•°æ–‡ä»¶ä¸­æŒ‡å®š

ä¿®æ”¹ `unitree_nav2_params.yaml`ï¼š

```yaml
bt_navigator:
  ros__parameters:
    default_nav_to_pose_bt_xml: "/home/ymc/ros2_nav_unitree_ws/src/nav_launcher/behavior_trees/custom_navigation.xml"
```

#### æ­¥éª¤ 3: æ›´æ–° setup.py

```python
data_files=[
    # ...
    # å®‰è£…è¡Œä¸ºæ ‘æ–‡ä»¶
    (os.path.join('share', package_name, 'behavior_trees'), 
        glob('behavior_trees/*.xml')),
]
```

---

## ğŸ¨ å¯è§†åŒ–å·¥å…·ï¼šGroot

### ä»€ä¹ˆæ˜¯ Grootï¼Ÿ

Groot æ˜¯è¡Œä¸ºæ ‘çš„**å¯è§†åŒ–ç¼–è¾‘å™¨**ï¼Œå¯ä»¥ï¼š
- ğŸ“Š å¯è§†åŒ–æŸ¥çœ‹è¡Œä¸ºæ ‘ç»“æ„
- âœï¸ æ‹–æ‹½ç¼–è¾‘è¡Œä¸ºæ ‘
- ğŸ” å®æ—¶ç›‘æ§æ‰§è¡ŒçŠ¶æ€
- ğŸ› è°ƒè¯•è¡Œä¸ºæ ‘

### å®‰è£… Groot

```bash
# å®‰è£…ä¾èµ–
sudo apt-get install qtbase5-dev libqt5svg5-dev libzmq3-dev libdw-dev

# ä¸‹è½½ Groot
cd ~/Downloads
wget https://github.com/BehaviorTree/Groot/releases/download/v1.5.0/Groot-v1.5.0-x86_64.AppImage

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x Groot-v1.5.0-x86_64.AppImage

# è¿è¡Œ
./Groot-v1.5.0-x86_64.AppImage
```

### ä½¿ç”¨ Groot æŸ¥çœ‹ Nav2 è¡Œä¸ºæ ‘

1. å¯åŠ¨å¯¼èˆª
2. æ‰“å¼€ Groot
3. é€‰æ‹© "Monitor" æ¨¡å¼
4. è¿æ¥åˆ° Nav2 çš„ ZMQ ç«¯å£

---

## ğŸ’¡ è¡Œä¸ºæ ‘å®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹ 1: å››è¶³æœºå™¨ç‹—å·¡é€»

**éœ€æ±‚ï¼š**
- å·¡é€» Aã€Bã€C ä¸‰ä¸ªç‚¹
- åœ¨æ¯ä¸ªç‚¹åœç•™ 10 ç§’
- é‡åˆ°äººç±»æ—¶ä¸»åŠ¨é¿è®©
- ç”µé‡ä½äº 30% è¿”å›å……ç”µ

**è¡Œä¸ºæ ‘è®¾è®¡ï¼š**

```xml
<BehaviorTree ID="PatrolTree">
  <ReactiveFallback>
    <!-- æ£€æŸ¥ç”µé‡ -->
    <IsBatteryLow min_battery="30.0">
      <NavigateToPose goal="{charging_station}"/>
    </IsBatteryLow>
    
    <!-- å·¡é€»é€»è¾‘ -->
    <Repeat num_cycles="99999">
      <SequenceStar>
        <!-- å·¡é€»ç‚¹ A -->
        <NavigateToPose goal="{point_a}"/>
        <Wait wait_duration="10"/>
        
        <!-- å·¡é€»ç‚¹ B -->
        <NavigateToPose goal="{point_b}"/>
        <Wait wait_duration="10"/>
        
        <!-- å·¡é€»ç‚¹ C -->
        <NavigateToPose goal="{point_c}"/>
        <Wait wait_duration="10"/>
      </SequenceStar>
    </Repeat>
  </ReactiveFallback>
</BehaviorTree>
```

### æ¡ˆä¾‹ 2: æ™ºèƒ½è·Ÿéš

**éœ€æ±‚ï¼š**
- è·Ÿéšç›®æ ‡äººç‰©
- ä¿æŒ 1.5 ç±³è·ç¦»
- ç›®æ ‡æ¶ˆå¤±æ—¶åŸåœ°ç­‰å¾…
- ç­‰å¾…è¶…è¿‡ 30 ç§’åè¿”å›èµ·ç‚¹

**è¡Œä¸ºæ ‘è®¾è®¡ï¼š**

```xml
<BehaviorTree ID="FollowPersonTree">
  <ReactiveFallback>
    <!-- æ£€æµ‹åˆ°ç›®æ ‡ -->
    <IsPersonDetected>
      <SequenceStar>
        <!-- è®¡ç®—è·Ÿéšç›®æ ‡ä½ç½®ï¼ˆ1.5ç±³åæ–¹ï¼‰ -->
        <ComputeFollowPose person_pose="{person_pose}" follow_distance="1.5" goal="{follow_goal}"/>
        
        <!-- å¯¼èˆªåˆ°ç›®æ ‡ä½ç½® -->
        <NavigateToPose goal="{follow_goal}" tolerance="0.3"/>
      </SequenceStar>
    </IsPersonDetected>
    
    <!-- æœªæ£€æµ‹åˆ°ç›®æ ‡ -->
    <SequenceStar>
      <!-- åŸåœ°ç­‰å¾… 30 ç§’ -->
      <Wait wait_duration="30"/>
      
      <!-- è¿”å›èµ·ç‚¹ -->
      <NavigateToPose goal="{home_position}"/>
    </SequenceStar>
  </ReactiveFallback>
</BehaviorTree>
```

---

## ğŸ” è¡Œä¸ºæ ‘è°ƒè¯•

### æŸ¥çœ‹è¡Œä¸ºæ ‘æ‰§è¡Œæ—¥å¿—

```bash
# å¯åŠ¨å¯¼èˆªæ—¶å¯ç”¨è¯¦ç»†æ—¥å¿—
ros2 launch nav_launcher unitree_navigation.launch.py --log-level debug

# å•ç‹¬æŸ¥çœ‹ bt_navigator æ—¥å¿—
ros2 node info /bt_navigator
```

### å¸¸è§é—®é¢˜

**é—®é¢˜ 1: è¡Œä¸ºæ ‘ä¸æ‰§è¡Œ**
```bash
# æ£€æŸ¥è¡Œä¸ºæ ‘æ–‡ä»¶è·¯å¾„
ros2 param get /bt_navigator default_nav_to_pose_bt_xml

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -l /path/to/behavior_tree.xml
```

**é—®é¢˜ 2: è¡Œä¸ºæ ‘æ‰§è¡Œå¤±è´¥**
```bash
# æŸ¥çœ‹é”™è¯¯ç 
ros2 topic echo /bt_navigator/transition_event

# æŸ¥çœ‹è¡Œä¸ºæ ‘çŠ¶æ€
ros2 topic echo /behavior_tree_log
```

---

## ğŸ“š å­¦ä¹ èµ„æº

- [BehaviorTree.CPP å®˜æ–¹æ–‡æ¡£](https://www.behaviortree.dev/)
- [Nav2 è¡Œä¸ºæ ‘æ•™ç¨‹](https://docs.nav2.org/behavior_trees/index.html)
- [Groot ç”¨æˆ·æŒ‡å—](https://github.com/BehaviorTree/Groot)
- [è¡Œä¸ºæ ‘æœ€ä½³å®è·µ](https://www.behaviortree.dev/docs/intro)

---

## ğŸ¯ æ€»ç»“

**è¡Œä¸ºæ ‘çš„æ ¸å¿ƒä»·å€¼ï¼š**

1. **æ™ºèƒ½å†³ç­–** - è‡ªåŠ¨å¤„ç†å¤æ‚åœºæ™¯
2. **æ¨¡å—åŒ–** - æ˜“äºæ‰©å±•å’Œç»´æŠ¤
3. **å¯è§†åŒ–** - ç›´è§‚ç†è§£å¯¼èˆªé€»è¾‘
4. **é²æ£’æ€§** - æ™ºèƒ½æ¢å¤ç­–ç•¥

**å¯¹äºæœºå™¨ç‹—å¯¼èˆªï¼š**
- âœ… å¤„ç†å¤æ‚çš„åŠ¨æ€ç¯å¢ƒ
- âœ… æ™ºèƒ½é¿éšœå’Œæ¢å¤
- âœ… æ”¯æŒå¤æ‚ä»»åŠ¡ç¼–æ’
- âœ… æ˜“äºæ·»åŠ è‡ªå®šä¹‰è¡Œä¸º

**ä¸‹ä¸€æ­¥ï¼š**
1. å…ˆä½¿ç”¨é»˜è®¤è¡Œä¸ºæ ‘ç†Ÿæ‚‰å¯¼èˆª
2. äº†è§£å„ä¸ªèŠ‚ç‚¹çš„ä½œç”¨
3. æ ¹æ®éœ€æ±‚è‡ªå®šä¹‰è¡Œä¸ºæ ‘
4. ä½¿ç”¨ Groot å¯è§†åŒ–è°ƒè¯•

å¸Œæœ›è¿™ä»½æŒ‡å—å¸®åŠ©ä½ ç†è§£è¡Œä¸ºæ ‘ï¼ğŸŒ³ğŸ¤–
